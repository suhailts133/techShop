<% layout("../layouts/boilerplate") %>
    <title>
        <%= title %>
    </title>

    <div class="container mt-4">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-light p-3 rounded">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/store">Store</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    <%= product.productName %>
                </li>
            </ol>
        </nav>

        <!-- Main Product Section -->
        <div class="row bg-white shadow-sm p-4 rounded">
            <!-- Product Images -->
            <div class="col-md-6">
                <div class="main-image-container mb-3">
                    <img id="main-image" src="/uploads/products/<%= product.productImage[0] %>"
                        class="img-fluid rounded" alt="Main Product Image">
                </div>
                <div class="thumbnail-gallery d-flex">
                    <% product.productImage.forEach(image=> { %>
                        <img src="/uploads/products/<%= image %>" alt="Thumbnail" class="img-thumbnail me-2 rounded"
                            style="width: 70px; height: 70px; cursor: pointer;"
                            onclick="updateMainImage('/uploads/products/<%= image %>')">
                        <% }); %>
                </div>
            </div>

            <!-- Product Details -->
            <div class="col-md-6">
                <h2 class="fw-bold mb-3">
                    <%= product.productName %>
                </h2>
                <p class="text-muted">
                    <%= product.description %>
                </p>
                <p class="text-muted">Brand: <span class="fw-bold">
                        <%= product.brand %>
                    </span></p>
                <p class="text-muted">Category: <span class="fw-bold">
                        <%= product.category.name %>
                    </span></p>

                <!-- Price Section -->
                <div class="mb-4">
                    <% const discount=Math.round(((product.variants[0].price - product.variants[0].salePrice) /
                        product.variants[0].price) * 100); %>
                        <p>
                            <span class="text-success fw-bold fs-4">₹<span id="price">
                                    <%= product.variants[0].salePrice %>
                                </span></span>
                            <span class="text-decoration-line-through text-muted ms-2 fs-5">₹<span id="regular-price">
                                    <%= product.variants[0].price %>
                                </span></span>
                            <span class="badge bg-danger ms-2 fs-6">-<%= discount %>% OFF</span>
                        </p>
                </div>

                <!-- Variant Selection -->
                <div class="mb-3">
                    <label for="variant" class="form-label fw-semibold">Select Variant:</label>
                    <select id="variant" class="form-select" data-product-id="<%= product._id %>"
                        onchange="updateVariantDetails()">
                        <% product.variants.forEach(variant=> { %>
                            <option value="<%= variant._id %>">
                                <%= variant.color %> - <%= variant.size %>
                            </option>
                            <% }) %>
                    </select>
                </div>

                <!-- Quantity Selector -->
                <div class="quantity-control d-flex align-items-center mb-4">
                    <button class="btn btn-outline-secondary me-2" onclick="changeQuantity(-1)">-</button>
                    <span id="selected-quantity" class="fs-5 fw-semibold">1</span>
                    <button class="btn btn-outline-secondary ms-2" onclick="changeQuantity(1)">+</button>
                    <div class="ms-3">
                        <p class="text-muted mb-0">Available Quantity: <span id="quantity">
                                <%= product.variants[0].quantity %>
                            </span></p>
                        <p id="quantity-error" class="text-danger fw-bold small mt-1" style="display: none;">Exceeds
                            available quantity.</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div>
                    <button class="btn btn-primary btn-lg me-2" onclick="addToCart()">Add to Cart</button>
                    <div id="cart-message" class="mt-3"></div>
                    <button class="btn btn-outline-secondary btn-lg">Add to Wishlist</button>
                </div>
            </div>
        </div>

        <!-- Related Products Section -->
        <div class="related-products mt-5">
            <h3 class="fw-bold mb-4">Related Products</h3>
            <div class="row">
                <% relatedProducts.forEach(product=> {
                    const variant = product.variants.find(v => v.quantity > 0); // Find the first available variant
                    %>
                    <% if (variant) { %> <!-- Check if a valid variant exists -->
                        <div class="col-md-3 mb-4">
                            <div class="card shadow-sm h-100">
                                <a href="/productDetails?id=<%= product._id %>">
                                    <img src="/uploads/products/<%= product.productImage[0] %>" class="card-img-top"
                                        alt="<%= product.productName %>">
                                </a>
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <%= product.productName %>
                                    </h5>
                                    <% const discount=Math.round(((variant.price - variant.salePrice) / variant.price) *
                                        100); %>
                                        <p class="card-text text-success fw-bold">₹<%= variant.salePrice %>
                                                <span class="text-decoration-line-through text-muted ms-2">₹<%=
                                                        variant.price %></span>
                                                <span class="badge bg-danger ms-2">-<%= discount %>% OFF</span>
                                        </p>
                                        <a href="/productDetails?id=<%= product._id %>"
                                            class="btn btn-sm btn-outline-primary">View Details</a>
                                </div>
                            </div>
                        </div>
                        <% } %>
                            <% }) %>
            </div>
        </div>
    </div>



    
    <script src="/js/productDetail.js"></script>